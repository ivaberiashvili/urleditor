<!DOCTYPE html>
<html>
<head>
  <title>URL Editor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f0f0f0;
      max-width: 1280px;
      margin: 0 auto;
    }

    .column {
      background-color: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h2 {
      margin-top: 0;
      color: #333;
    }

    label {
      font-size: 0.9em;
      margin-bottom: 6px;
      display: inline-block;
    }

    textarea {
      display: block;
      width: 100%;
      height: 240px;
      overflow-x: hidden;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
      word-break: break-word;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
      font-size: 16px;
      padding: 8px;
      margin-bottom: 20px;
      border: 1px solid #ddd;
      border-radius: 4px;
      resize: vertical;
    }

    .output {
      height: 240px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
      word-break: break-word;
      box-sizing: border-box;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
      padding: 8px;
      font-size: 16px;
    }

    .matchMessage {
      font-size: 0.9em;
      font-weight: bold;
      margin-top: 5px;
      line-height: 1.4;
      min-height: 18px;
    }
  </style>
</head>
<body>
  <h1>URL Editor</h1>
  <div class="column">
    <h2 id="sectionTitle">Clicks</h2>
    <label for="clicksInput">Input</label>
    <textarea id="clicksInput" placeholder="Paste URL here..."></textarea>

    <label for="clicksOutput">Output</label>
    <div id="clicksOutput" class="output"></div>
    <div id="clicksMessage" class="matchMessage"></div>
  </div>

  <script>
    function escapeHtml(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    function colorizeString(rawUrl) {
      const questionIndex = rawUrl.indexOf("?");
      if (questionIndex === -1) {
        return escapeHtml(rawUrl);
      }

      const baseUrl = rawUrl.slice(0, questionIndex + 1);
      const query = rawUrl.slice(questionIndex + 1);

      let escapedBase = escapeHtml(baseUrl);

      // Highlight only id123 if it's an appsflyer link
      if (rawUrl.includes("appsflyer")) {
        escapedBase = escapedBase.replace(/(id\d+)/, `<span style="color: #4CAF50;">$1</span>`);
      }

      const params = query.split("&");
      const coloredParams = params.map(param => {
        if (param.includes("=")) {
          const [key, ...valParts] = param.split("=");
          const value = valParts.join("=");
          return `<span style="color: #ff477e;">${escapeHtml(key)}=</span><span style="color: #5465ff;">${escapeHtml(value)}</span>`;
        } else {
          return `<span style="color: red;">${escapeHtml(param)}</span>`;
        }
      });

      return escapedBase + coloredParams.join(`<span style="color: black;">&amp;</span>`);
    }

    function checkUrlMatch(inputValue, outputDiv, messageElement) {
      const outputText = outputDiv.textContent;
      if (inputValue === outputText) {
        messageElement.textContent = "URLs match";
        messageElement.style.color = "green";
      } else {
        messageElement.textContent = "URLs mismatch";
        messageElement.style.color = "red";
      }
    }

    const clicksInput = document.getElementById("clicksInput");
    const clicksOutput = document.getElementById("clicksOutput");
    const clicksMessage = document.getElementById("clicksMessage");
    const sectionTitle = document.getElementById("sectionTitle");

    clicksInput.addEventListener("input", function () {
      const raw = this.value;

      // Dynamic section title based on input
      if (raw.includes("appsflyer")) {
        if (raw.includes("impression")) {
          sectionTitle.textContent = "Impressions";
        } else if (raw.includes("app")) {
          sectionTitle.textContent = "Clicks";
        } else {
          sectionTitle.textContent = "Appsflyer URL";
        }
      } else {
        sectionTitle.textContent = "Clicks";
      }

      const result = colorizeString(raw);
      clicksOutput.innerHTML = result;
      checkUrlMatch(raw, clicksOutput, clicksMessage);
    });
  </script>
</body>
</html>